/**
 * @name index.js<beez-touch/s>
 * @author Masaki Sueda <s.masaki07@gmail.com>
 * @overview Touch event plug-in for Beez (browser)
 * @license MIT
 */

var BEEZ_TOUCH_VERSION="0.2.6";"undefined"!=typeof module&&module.exports?exports.VERSION=BEEZ_TOUCH_VERSION:!function(){define("beez.touch",["require","exports","module","beez"],function(t){var e=t("beez"),a=e.getLogger("beez.touch");if(e.touch)return a.warn("beez.touch is already loaded."),e.touch;var c=e.vendor._,h=e.vendor.$,n="ontouchstart"in window,o={start:{name:n?"touchstart":"mousedown",callback:"onBztchTapStart"},move:{name:n?"touchmove":"mousemove",callback:"onBztchTapMove"},end:{name:n?"touchend":"mouseup",callback:"onBztchTapEnd"}},s=function(t){var e;return n?t.originalEvent?(e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]):e=t.changedTouches[0]&&t.changedTouches[0]:e=t,t.pageX=e.pageX,t.pageY=e.pageY,t},i=function(){return i=function(){},i.prototype={initialize:function(t){l.__super__.initialize.apply(this,arguments),t=t||{},t.bztch=t.bztch||{},this._bztchTaps=null,this._bztchIsTappable=!1,this._bztchIsDisable=!1,this._bztchIsTapMouseDown=!1,this._bztchPrefix=c.isString(t.bztch.prefix)?t.bztch.prefix:"bztch",this._bztchTapPrefix=this._bztchPrefix+"-tap",this._bztchHoverClassName=c.isString(t.bztch.hoverClassName)?t.bztch.hoverClassName:"hover",this._bztchStartPosition={},this._bztchTimer=new e.utils.Timers,this._bztchThreshold=t.bztch.threshold||10},tap:function t(a,h,n,s){var t,i,l=this;return s=c.defaults(s||{},{tapStart:e.none,tapMove:e.none,tapEnd:e.none,tapHold:e.none,callback:e.none,context:l}),e.utils.isArray(a)&&a.length>1?void c.each(a,function(t,e){l.tap(a.eq(e),h,n,s)}):(l._bztchTaps||(c.each(o,function(t){var h=t.name+".delegateEvents"+l.cid,n=t.callback;a===l.$el?l.$el.on(h,c.bind(l[n],l)||e.none):l.$el.on(h,"."+l._bztchTapPrefix,c.bind(l[n],l)||e.none)}),l._bztchTaps={}),t={callback:s.callback,callbackStart:s.tapStart,callbackMove:s.tapMove,callbackEnd:s.tapEnd,callbackHold:s.tapHold,holdDuration:s.holdDuration,context:n},a.hasClass(l._bztchTapPrefix)?(i=a.attr("data-"+l._bztchTapPrefix+"Uid"),l._bztchTaps[i].push(t)):(i=c.uniqueId(l._bztchTapPrefix+"-"),l._bztchTaps[i]=[t],a.addClass(l._bztchTapPrefix),a.attr("data-"+l._bztchTapPrefix+"Uid",i)),t.holdDuration&&a.css({"-webkit-touch-callout":"none"}),l)},longTap:function(t,e,a,c){return this.tap(t,null,a,{tapHold:e,holdDuration:c.holdDuration||1e3})},onBztchTapStart:function(t){var e,a,n=this,o=h(t.currentTarget);e=n._bztchGetId(o),e&&n._bztchHasTap(e)&&(a=n._bztchTaps[e],t=s(t),n._bztchStartPosition={x:t.pageX,y:t.pageY},o.hasClass(n._bztchDisableClassName)||(n._bztchIsTappable=!0,o.addClass(n._bztchHoverClassName),c.each(a,function(e){e.holdDuration&&(e.timerId&&n._bztchTimer.clearTimeout(e.timerId),e.timerId=n._bztchTimer.addTimeout(function(){return n._bztchIsTappable?(e.callbackHold.call(e.context,t),void n._bztchCancel()):void n._bztchCancel()},e.holdDuration)),e.callbackStart.call(e.context,t)})))},onBztchTapMove:function(t){var e,a,n=this,o=h(t.currentTarget);return n._bztchIsTappable?(e=n._bztchGetId(o),void(e&&n._bztchHasTap(e)&&(a=n._bztchTaps[e],t=s(t),c.each(a,function(e){e.callbackMove.call(e.context,t)}),(Math.abs(t.pageX-n._bztchStartPosition.x)>n._bztchThreshold||Math.abs(t.pageY-n._bztchStartPosition.y)>n._bztchThreshold)&&(n._bztchCancel(),n._bztchIsTappable=!1,o.removeClass(n._bztchHoverClassName))))):void n._bztchCancel()},onBztchTapEnd:function(t){var e,a,n=this,o=h(t.currentTarget);return n._bztchIsTappable?(n._bztchIsTappable=!1,e=n._bztchGetId(o),void(e&&n._bztchHasTap(e)&&(a=n._bztchTaps[e],t=s(t),o.hasClass(n._bztchDisableClassName)||c.each(a,function(e){e.callbackEnd.call(e.context,t),e.callback.call(e.context,t)}),o.removeClass(n._bztchHoverClassName),n._bztchCancel()))):void this._bztchCancel()},_bztchCancel:function(){this._bztchTimer.stop()},_bztchGetId:function(t){return t.attr("data-"+this._bztchTapPrefix+"Uid")},_bztchHasTap:function(t){return c.has(this._bztchTaps?this._bztchTaps:{},t)},dispose:function(){c.each(this._bztchTaps,function(t,e){delete this._bztchTaps[e].callback,delete this._bztchTaps[e].callbackStart,delete this._bztchTaps[e].callbackMove,delete this._bztchTaps[e].context,delete this._bztchTaps[e]},this),delete this._bztchTaps,delete this._bztchIsTappable,delete this._bztchIsTapMouseDown,delete this._bztchPrefix,delete this._bztchTapPrefix,delete this._bztchHoverClassName,delete this._bztchStartPosition,l.__super__.dispose.apply(this,arguments)}},i}(this),l=e.View.extend("beez.Touch",i.prototype);return e.touch={View:l,__inheritance__:i},e.touch})}(this);