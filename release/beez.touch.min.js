/**
 * @name index.js<beez-touch/s>
 * @author Masaki Sueda <s.masaki07@gmail.com>
 * @overview Touch event plug-in for Beez (browser)
 * @license MIT
 */

var BEEZ_TOUCH_VERSION="0.2.4";"undefined"!=typeof module&&module.exports?exports.VERSION=BEEZ_TOUCH_VERSION:!function(){define("beez.touch",["require","exports","module","beez"],function(t){var e=t("beez"),a=e.getLogger("beez.touch");if(e.touch)return a.warn("beez.touch is already loaded."),e.touch;var h=e.vendor._,c=e.vendor.$,s="ontouchstart"in window,i={start:{name:s?"touchstart":"mousedown",callback:"onBztchTapStart"},move:{name:s?"touchmove":"mousemove",callback:"onBztchTapMove"},end:{name:s?"touchend":"mouseup",callback:"onBztchTapEnd"}},n=function(t){var e;return s?t.originalEvent?(e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]):e=t.changedTouches[0]&&t.changedTouches[0]:e=t,t.pageX=e.pageX,t.pageY=e.pageY,t},o=function(){return o=function(){},o.prototype={initialize:function(t){l.__super__.initialize.apply(this,arguments),t=t||{},t.bztch=t.bztch||{},this._bztchTaps=null,this._bztchIsTappable=!1,this._bztchIsDisable=!1,this._bztchIsTapMouseDown=!1,this._bztchPrefix=h.isString(t.bztch.prefix)?t.bztch.prefix:"bztch",this._bztchTapPrefix=this._bztchPrefix+"-tap",this._bztchHoverClassName=h.isString(t.bztch.hoverClassName)?t.bztch.hoverClassName:"hover",this._bztchPreventDefault=t.bztch.preventDefault||!1,this._bztchStartPosition={},this._bztchThreshold=t.bztch.threshold||10,this._bztchHoldDuration=t.bztch.holdDuration||1e3},tap:function(t,a,c,s){var n,o=this;return s=h.defaults(s||{},{tapStart:e.none,tapMove:e.none,tapEnd:e.none,context:o}),e.utils.isArray(t)&&t.length>1?void h.each(t,function(e,h){o.tap(t.eq(h),a,c,s)}):(o._bztchTaps||(h.each(i,function(a){var c=a.name+".delegateEvents"+o.cid,s=a.callback;t===o.$el?o.$el.on(c,h.bind(o[s],o)||e.none):o.$el.on(c,"."+o._bztchTapPrefix,h.bind(o[s],o)||e.none)}),o._bztchTaps={}),n=h.uniqueId(o._bztchTapPrefix+"-"),o._bztchTaps[n]={callback:a,callbackStart:s.tapStart,callbackMove:s.tapMove,callbackEnd:s.tapEnd,callbackHold:s.tapHold,context:c},t.addClass(this._bztchTapPrefix),void t.attr("data-"+this._bztchTapPrefix+"Uid",n))},onBztchTapStart:function(t){var e,a=this,h=c(t.currentTarget);t=n(t),e=a.bztchGetId(h),a._bztchTaps[e].callbackHold&&setTimeout(function(){a.onBztchTapHold.call(a,t)},a._bztchHoldDuration),e&&a.bztchHasTap(e)&&(a._bztchPreventDefault&&t.preventDefault(),a._bztchStartPosition={x:t.pageX,y:t.pageY},h.hasClass(a._bztchDisableClassName)||(a._bztchIsTappable=!0,a._bztchTaps[e].callbackStart.call(a._bztchTaps[e].context,t),h.addClass(a._bztchHoverClassName)))},onBztchTapMove:function(t){var e,a=c(t.currentTarget);this._bztchIsTappable&&(t=n(t),e=this.bztchGetId(a),e&&this.bztchHasTap(e)&&(this._bztchPreventDefault&&t.preventDefault(),this._bztchTaps[e].callbackMove.call(this._bztchTaps[e].context,t),(Math.abs(t.pageX-this._bztchStartPosition.x)>this._bztchThreshold||Math.abs(t.pageY-this._bztchStartPosition.y)>this._bztchThreshold)&&(this._bztchIsTappable=!1,a.removeClass(this._bztchHoverClassName))))},onBztchTapEnd:function(t){var e,a=c(t.currentTarget);if(t=n(t),e=this.bztchGetId(a),e&&this.bztchHasTap(e)){if(this._bztchPreventDefault&&t.preventDefault(),this._bztchIsTappable&&!a.hasClass(this._bztchDisableClassName)){if(this._bztchTaps[e].callback&&this._bztchTaps[e].callback.call(this._bztchTaps[e].context,t),!this._bztchTaps)return;this._bztchTaps[e].callbackEnd.call(this._bztchTaps[e].context,t)}this._bztchIsTappable=!1,a.removeClass(this._bztchHoverClassName)}},onBztchTapHold:function(t){var e,a=c(t.currentTarget);t=n(t),e=this.bztchGetId(a),e&&this.bztchHasTap(e)&&(this._bztchTaps[e].callbackHold.call(this._bztchTaps[e].context,t),this._bztchIsTappable=!1,a.removeClass(this._bztchHoverClassName))},bztchGetId:function(t){return console.log(t),t.attr("data-"+this._bztchTapPrefix+"Uid")},bztchHasTap:function(t){return h.has(this._bztchTaps?this._bztchTaps:{},t)},dispose:function(){h.each(this._bztchTaps,function(t,e){delete this._bztchTaps[e].callback,delete this._bztchTaps[e].callbackStart,delete this._bztchTaps[e].callbackMove,delete this._bztchTaps[e].context,delete this._bztchTaps[e]},this),delete this._bztchTaps,delete this._bztchIsTappable,delete this._bztchIsTapMouseDown,delete this._bztchPrefix,delete this._bztchTapPrefix,delete this._bztchHoverClassName,delete this._bztchStartPosition,l.__super__.dispose.apply(this,arguments)}},o}(this),l=e.View.extend("beez.Touch",o.prototype);return e.touch={View:l,__inheritance__:o},e.touch})}(this);