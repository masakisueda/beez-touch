/**
 * @name index.js<beez-touch/s>
 * @author Masaki Sueda <s.masaki07@gmail.com>
 * @overview Touch event plug-in for Beez (browser)
 * @license MIT
 */

var BEEZ_TOUCH_VERSION="0.2.9";"undefined"!=typeof module&&module.exports?exports.VERSION=BEEZ_TOUCH_VERSION:!function(){define("beez.touch",["require","exports","module","beez"],function(t){var e=t("beez"),a=e.getLogger("beez.touch");if(e.touch)return a.warn("beez.touch is already loaded."),e.touch;var c=e.vendor._,h=e.vendor.$,s="ontouchstart"in window,o={start:{name:s?"touchstart":"mousedown",callback:"onBztchTapStart"},move:{name:s?"touchmove":"mousemove",callback:"onBztchTapMove"},end:{name:s?"touchend":"mouseup",callback:"onBztchTapEnd"}},n=function(t){var e;return s?t.originalEvent?(e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]):e=t.changedTouches[0]&&t.changedTouches[0]:e=t,t.pageX=e.pageX,t.pageY=e.pageY,t},i=function(){return i=function(){},i.prototype={initialize:function(t){l.__super__.initialize.apply(this,arguments),t=t||{},t.bztch=t.bztch||{},this._bztchTaps=null,this._bztchIsTappable=!1,this._bztchIsDisable=!1,this._bztchIsTapMouseDown=!1,this._bztchPrefix=c.isString(t.bztch.prefix)?t.bztch.prefix:"bztch",this._bztchTapPrefix=this._bztchPrefix+"-tap",this._bztchHoverClassName=c.isString(t.bztch.hoverClassName)?t.bztch.hoverClassName:"hover",this._bztchStartPosition={},this._bztchTimer=new e.utils.Timers,this._bztchThreshold=t.bztch.threshold||10},tap:function t(a,h,s,n){var t,i,l=this;return n=c.defaults(n||{},{tapStart:e.none,tapMove:e.none,tapEnd:e.none,tapHold:e.none,context:l}),e.utils.isArray(a)&&a.length>1?void c.each(a,function(t,e){l.tap(a.eq(e),h,s,n)}):(l._bztchTaps||(c.each(o,function(t){var h=t.name+".delegateEvents"+l.cid,s=t.callback;a===l.$el?l.$el.on(h,c.bind(l[s],l)||e.none):l.$el.on(h,"."+l._bztchTapPrefix,c.bind(l[s],l)||e.none)}),l._bztchTaps={}),t={callback:h||e.none,callbackStart:n.tapStart,callbackMove:n.tapMove,callbackEnd:n.tapEnd,callbackHold:n.tapHold,holdDuration:n.holdDuration,context:s},a.hasClass(l._bztchTapPrefix)?(i=a.attr("data-"+l._bztchTapPrefix+"Uid"),c.isEmpty(l._bztchTaps[i])&&(l._bztchTaps[i]=[]),l._bztchTaps[i].push(t)):(i=c.uniqueId(l._bztchTapPrefix+"-"),l._bztchTaps[i]=[t],a.addClass(l._bztchTapPrefix),a.attr("data-"+l._bztchTapPrefix+"Uid",i)),t.holdDuration&&a.css({"-webkit-touch-callout":"none"}),l)},longTap:function(t,e,a,c){return this.tap(t,null,a,{tapHold:e,holdDuration:c.holdDuration||1e3})},onBztchTapStart:function(t){var e,a,s=this,o=h(t.currentTarget);t.stopPropagation(),e=s._bztchGetId(o),e&&s._bztchHasTap(e)&&(a=s._bztchTaps[e],t=n(t),s._bztchStartPosition={x:t.pageX,y:t.pageY},o.hasClass(s._bztchDisableClassName)||(s._bztchIsTappable=!0,o.addClass(s._bztchHoverClassName),c.each(a,function(e){e.holdDuration&&(e.timerId&&s._bztchTimer.clearTimeout(e.timerId),e.timerId=s._bztchTimer.addTimeout(function(){return s._bztchIsTappable?(e.callbackHold.call(e.context,t),void s._bztchCancel(t)):void s._bztchCancel(t)},e.holdDuration)),e.callbackStart.call(e.context,t)})))},onBztchTapMove:function(t){var e,a,s=this,o=h(t.currentTarget);return s._bztchIsTappable?(e=s._bztchGetId(o),void(e&&s._bztchHasTap(e)&&(a=s._bztchTaps[e],t=n(t),c.each(a,function(e){e.callbackMove.call(e.context,t)}),(Math.abs(t.pageX-s._bztchStartPosition.x)>s._bztchThreshold||Math.abs(t.pageY-s._bztchStartPosition.y)>s._bztchThreshold)&&(s._bztchCancel(t),s._bztchIsTappable=!1,o.removeClass(s._bztchHoverClassName))))):void s._bztchCancel(t)},onBztchTapEnd:function(t){var a,s,o=this,i=h(t.currentTarget);if(t.stopPropagation(),t.preventDefault(),!o._bztchIsTappable)return void this._bztchCancel(t);if(o._bztchIsTappable=!1,a=o._bztchGetId(i),a&&o._bztchHasTap(a)){if(s=o._bztchTaps[a],t=n(t),!i.hasClass(o._bztchDisableClassName)){var l=e.utils.browser.ua.android?100:0;setTimeout(function(){c.each(s,function(e){e.callbackEnd.call(e.context,t),e.callback.call(e.context,t)})},l)}i.removeClass(o._bztchHoverClassName),o._bztchCancel(t)}},_bztchCancel:function(t){this._bztchTimer.stop(),this._bztchIsTappable=!1,h(t.currentTarget).removeClass(this._bztchHoverClassName)},_bztchGetId:function(t){return t.attr("data-"+this._bztchTapPrefix+"Uid")},_bztchHasTap:function(t){return c.has(this._bztchTaps?this._bztchTaps:{},t)},dispose:function(){c.each(this._bztchTaps,function(t,e){c.each(t,function(t,a){delete this._bztchTaps[e][a].callback,delete this._bztchTaps[e][a].callbackStart,delete this._bztchTaps[e][a].callbackMove,delete this._bztchTaps[e][a].callbackHold,delete this._bztchTaps[e][a].context,delete this._bztchTaps[e][a]},this),delete this._bztchTaps[e]},this),delete this._bztchTaps,delete this._bztchIsTappable,delete this._bztchIsTapMouseDown,delete this._bztchPrefix,delete this._bztchTapPrefix,delete this._bztchHoverClassName,delete this._bztchStartPosition,l.__super__.dispose.apply(this,arguments)}},i}(this),l=e.View.extend("beez.Touch",i.prototype);return e.touch={View:l,__inheritance__:i},e.touch})}(this);