/**
 * @name index.js<beez-touch/s>
 * @author Masaki Sueda <s.masaki07@gmail.com>
 * @overview Touch event plug-in for Beez (browser)
 * @license MIT
 */

var BEEZ_TOUCH_VERSION="0.2.9";"undefined"!=typeof module&&module.exports?exports.VERSION=BEEZ_TOUCH_VERSION:!function(){define("beez.touch",["require","exports","module","beez"],function(t){var e=t("beez"),a=e.getLogger("beez.touch");if(e.touch)return a.warn("beez.touch is already loaded."),e.touch;var c=e.vendor._,s=e.vendor.$,h="ontouchstart"in window,i={start:{name:h?"touchstart":"mousedown",callback:"onBztchTapStart"},move:{name:h?"touchmove":"mousemove",callback:"onBztchTapMove"},end:{name:h?"touchend":"mouseup",callback:"onBztchTapEnd"}},n=function(t){var e;return h?t.originalEvent?(e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]):e=t.changedTouches[0]&&t.changedTouches[0]:e=t,t.pageX=e.pageX,t.pageY=e.pageY,t},o=function(){return o=function(){},o.prototype={initialize:function(t){l.__super__.initialize.apply(this,arguments),t=t||{},t.bztch=t.bztch||{},this._bztchTaps=null,this._bztchIsTappable=!1,this._bztchIsDisable=!1,this._bztchIsTapMouseDown=!1,this._bztchPrefix=c.isString(t.bztch.prefix)?t.bztch.prefix:"bztch",this._bztchTapPrefix=this._bztchPrefix+"-tap",this._bztchHoverClassName=c.isString(t.bztch.hoverClassName)?t.bztch.hoverClassName:"hover",this._bztchDisableClassName=c.isString(t.bztch.disableClassName)?t.bztch.disableClassName:"disable",this._bztchStartPosition={},this._bztchTimer=new e.utils.Timers,this._bztchThreshold=t.bztch.threshold||10},tap:function t(a,s,h,n){var t,o,l=this;return n=c.defaults(n||{},{tapStart:e.none,tapMove:e.none,tapEnd:e.none,tapHold:e.none,context:l}),e.utils.isArray(a)&&a.length>1?void c.each(a,function(t,e){l.tap(a.eq(e),s,h,n)}):(l._bztchTaps||(c.each(i,function(t){var s=t.name+".delegateEvents"+l.cid,h=t.callback;a===l.$el?l.$el.on(s,c.bind(l[h],l)||e.none):l.$el.on(s,"."+l._bztchTapPrefix,c.bind(l[h],l)||e.none)}),l._bztchTaps={}),t={callback:s||e.none,callbackStart:n.tapStart,callbackMove:n.tapMove,callbackEnd:n.tapEnd,callbackHold:n.tapHold,holdDuration:n.holdDuration,once:n.once||!1,$elm:a,context:h},a.hasClass(l._bztchTapPrefix)?(o=a.attr("data-"+l._bztchTapPrefix+"Uid"),c.isEmpty(l._bztchTaps[o])&&(l._bztchTaps[o]=[]),l._bztchTaps[o].push(t)):(o=c.uniqueId(l._bztchTapPrefix+"-"),l._bztchTaps[o]=[t],a.addClass(l._bztchTapPrefix),a.attr("data-"+l._bztchTapPrefix+"Uid",o)),t.holdDuration&&a.css({"-webkit-touch-callout":"none"}),l)},longTap:function(t,e,a,c){return this.tap(t,null,a,{tapHold:e,holdDuration:c.holdDuration||1e3})},tapOnce:function(t,e,a,s){return s=c.extend(s||{},{once:!0}),this.tap(t,e,a,s)},onBztchTapStart:function(t){var e,a,h=this,i=s(t.currentTarget);t.stopPropagation(),e=h._bztchGetId(i),e&&h._bztchHasTap(e)&&(a=h._bztchTaps[e],t=n(t),h._bztchStartPosition={x:t.pageX,y:t.pageY},i.hasClass(h._bztchDisableClassName)||(h._bztchIsTappable=!0,i.addClass(h._bztchHoverClassName),c.each(a,function(e){e.holdDuration&&(e.timerId&&h._bztchTimer.clearTimeout(e.timerId),e.timerId=h._bztchTimer.addTimeout(function(){return h._bztchIsTappable?(e.callbackHold.call(e.context,t),void h._bztchCancel(t)):void h._bztchCancel(t)},e.holdDuration)),e.callbackStart.call(e.context,t)})))},onBztchTapMove:function(t){var e,a,h=this,i=s(t.currentTarget);return h._bztchIsTappable?(e=h._bztchGetId(i),void(e&&h._bztchHasTap(e)&&(a=h._bztchTaps[e],t=n(t),c.each(a,function(e){e.callbackMove.call(e.context,t)}),(Math.abs(t.pageX-h._bztchStartPosition.x)>h._bztchThreshold||Math.abs(t.pageY-h._bztchStartPosition.y)>h._bztchThreshold)&&(h._bztchCancel(t),h._bztchIsTappable=!1,i.removeClass(h._bztchHoverClassName))))):void h._bztchCancel(t)},onBztchTapEnd:function(t){var a,h,i=this,o=s(t.currentTarget);if(t.stopPropagation(),t.preventDefault(),!i._bztchIsTappable)return void this._bztchCancel(t);if(i._bztchIsTappable=!1,a=i._bztchGetId(o),a&&i._bztchHasTap(a)){if(h=i._bztchTaps[a],t=n(t),!o.hasClass(i._bztchDisableClassName)){var l=e.utils.browser.ua.android?100:0;setTimeout(function(){c.each(h,function(e,c){e.callbackEnd.call(e.context,t),e.callback.call(e.context,t),e.once&&i._disposeTap(a,c)})},l)}o.removeClass(i._bztchHoverClassName),i._bztchCancel(t)}},_bztchCancel:function(t){this._bztchTimer.stop(),this._bztchIsTappable=!1,s(t.currentTarget).removeClass(this._bztchHoverClassName)},_bztchGetId:function(t){return t.attr("data-"+this._bztchTapPrefix+"Uid")},_bztchHasTap:function(t){return c.has(this._bztchTaps?this._bztchTaps:{},t)},enable:function(t){t?t.removeClass(this._bztchDisableClassName):c.each(this._bztchTaps,function(t){t.$elm&&t.$elm.removeClass(this._bztchDisableClassName)})},disable:function(t){t?t.addClass(this._bztchDisableClassName):c.each(this._bztchTaps,function(t){t.$elm&&t.$elm.addClass(this._bztchDisableClassName)})},_disposeTap:function(t,e){delete this._bztchTaps[t][e].callback,delete this._bztchTaps[t][e].callbackStart,delete this._bztchTaps[t][e].callbackMove,delete this._bztchTaps[t][e].callbackHold,delete this._bztchTaps[t][e].context,delete this._bztchTaps[t][e].$elm,delete this._bztchTaps[t][e]},dispose:function(){c.each(this._bztchTaps,function(t,e){c.each(t,function(t,a){this._disposeTap(e,a)},this),delete this._bztchTaps[e]},this),delete this._bztchTaps,delete this._bztchIsTappable,delete this._bztchIsTapMouseDown,delete this._bztchPrefix,delete this._bztchTapPrefix,delete this._bztchHoverClassName,delete this._bztchStartPosition,l.__super__.dispose.apply(this,arguments)}},o}(this),l=e.View.extend("beez.Touch",o.prototype);return e.touch={View:l,__inheritance__:o},e.touch})}(this);